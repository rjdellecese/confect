{"version":3,"file":"Api.js","names":["Predicate","Record","defineConvexSchema"],"sources":["../../../src/server/Api.ts"],"sourcesContent":["import type { GenericSchema, SchemaDefinition } from \"convex/server\";\nimport { defineSchema as defineConvexSchema } from \"convex/server\";\nimport { pipe, Predicate, Record } from \"effect\";\nimport type * as Spec from \"../api/Spec\";\nimport type * as DatabaseSchema from \"./DatabaseSchema\";\n\nexport const TypeId = \"@rjdellecese/confect/server/Api\";\nexport type TypeId = typeof TypeId;\n\nexport const isApi = (u: unknown): u is Api.Any =>\n  Predicate.hasProperty(u, TypeId);\n\nexport interface Api<\n  Schema_ extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Spec_ extends Spec.Spec.AnyWithProps,\n> {\n  readonly [TypeId]: TypeId;\n  readonly spec: Spec_;\n  readonly schema: Schema_;\n  readonly convexSchemaDefinition: SchemaDefinition<GenericSchema, true>;\n}\n\nexport declare namespace Api {\n  export interface Any {\n    readonly [TypeId]: TypeId;\n  }\n\n  export interface AnyWithProps extends Any {\n    readonly spec: Spec.Spec.AnyWithProps;\n    readonly schema: DatabaseSchema.DatabaseSchema.AnyWithProps;\n    readonly convexSchemaDefinition: SchemaDefinition<GenericSchema, true>;\n  }\n\n  export type Schema<Api_ extends AnyWithProps> = Api_[\"schema\"];\n\n  export type Groups<Api_ extends AnyWithProps> = Spec.Spec.Groups<\n    Api_[\"spec\"]\n  >;\n}\n\nconst Proto = {\n  [TypeId]: TypeId,\n};\n\nconst makeProto = <\n  Schema_ extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Spec_ extends Spec.Spec.AnyWithProps,\n>({\n  schema,\n  spec,\n}: {\n  schema: DatabaseSchema.DatabaseSchema.AnyWithProps;\n  spec: Spec_;\n}): Api<Schema_, Spec_> =>\n  Object.assign(Object.create(Proto), {\n    schema,\n    spec,\n    convexSchemaDefinition: pipe(\n      schema.tables,\n      Record.map(({ tableDefinition }) => tableDefinition),\n      defineConvexSchema,\n    ),\n  });\n\nexport const make = <\n  Schema_ extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Spec_ extends Spec.Spec.AnyWithProps,\n>(\n  schema: Schema_,\n  spec: Spec_,\n): Api<Schema_, Spec_> => makeProto({ schema, spec });\n"],"mappings":";;;;;;;;;;AAMA,MAAa,SAAS;AAGtB,MAAa,SAAS,MACpBA,iBAAU,YAAY,GAAG,OAAO;AA8BlC,MAAM,QAAQ,GACX,SAAS,QACX;AAED,MAAM,aAGJ,EACA,QACA,WAKA,OAAO,OAAO,OAAO,OAAO,MAAM,EAAE;CAClC;CACA;CACA,yCACE,OAAO,QACPC,cAAO,KAAK,EAAE,sBAAsB,gBAAgB,EACpDC,2BACD;CACF,CAAC;AAEJ,MAAa,QAIX,QACA,SACwB,UAAU;CAAE;CAAQ;CAAM,CAAC"}