{"version":3,"file":"GroupImpl.js","names":["Context","Layer","Effect"],"sources":["../../../src/server/GroupImpl.ts"],"sourcesContent":["import { Context, Effect, Layer } from \"effect\";\nimport type * as GroupSpec from \"../api/GroupSpec\";\nimport type * as Api from \"./Api\";\nimport type * as FunctionImpl from \"./FunctionImpl\";\n\n// ============================================================================\n// GroupImpl Service Tag\n// ============================================================================\n\nexport interface GroupImpl<GroupPath extends string> {\n  readonly groupPath: GroupPath;\n}\n\nexport const GroupImpl = <GroupPath extends string>({\n  groupPath,\n}: {\n  groupPath: GroupPath;\n}) =>\n  Context.GenericTag<GroupImpl<GroupPath>>(\n    `@rjdellecese/confect/server/GroupImpl/${groupPath}`,\n  );\n\n// ============================================================================\n// make - Create Group Implementation Layer\n// ============================================================================\n\nexport const make = <\n  Api_ extends Api.Api.AnyWithProps,\n  const GroupPath extends GroupSpec.Path.All<Api.Api.Groups<Api_>>,\n>(\n  _api: Api_,\n  groupPath: GroupPath,\n): Layer.Layer<\n  GroupImpl<GroupPath>,\n  never,\n  | GroupImpl.FromGroupWithPath<GroupPath, Api.Api.Groups<Api_>>\n  | FunctionImpl.FunctionImpl.FromGroupAtPath<GroupPath, Api.Api.Groups<Api_>>\n> => {\n  return Layer.effect(\n    GroupImpl<GroupPath>({\n      groupPath,\n    }),\n    Effect.gen(function* () {\n      // Wait for all required subgroup and function implementations to be provided\n      // The Layer requirements ensure they exist before this effect runs\n      yield* Effect.void;\n\n      return {\n        groupPath,\n      };\n    }),\n  ) as Layer.Layer<\n    GroupImpl<GroupPath>,\n    never,\n    | GroupImpl.FromGroupWithPath<GroupPath, Api.Api.Groups<Api_>>\n    | FunctionImpl.FunctionImpl.FromGroupAtPath<GroupPath, Api.Api.Groups<Api_>>\n  >;\n};\n\n// ============================================================================\n// Namespace Types\n// ============================================================================\n\nexport declare namespace GroupImpl {\n  export type FromGroups<Groups extends GroupSpec.GroupSpec.Any> =\n    Groups extends never\n      ? never\n      : Groups extends GroupSpec.GroupSpec.AnyWithProps\n        ? GroupImpl<GroupSpec.GroupSpec.Name<Groups>>\n        : never;\n\n  export type FromGroupWithPath<\n    GroupPath extends string,\n    Group extends GroupSpec.GroupSpec.AnyWithProps,\n  > =\n    GroupSpec.Path.SubGroupsAt<Group, GroupPath> extends infer SubGroupPaths\n      ? SubGroupPaths extends string\n        ? GroupImpl<SubGroupPaths>\n        : never\n      : never;\n}\n"],"mappings":";;;;;;;;AAaA,MAAa,aAAuC,EAClD,gBAIAA,eAAQ,WACN,yCAAyC,YAC1C;AAMH,MAAa,QAIX,MACA,cAMG;AACH,QAAOC,aAAM,OACX,UAAqB,EACnB,WACD,CAAC,EACFC,cAAO,IAAI,aAAa;AAGtB,SAAOA,cAAO;AAEd,SAAO,EACL,WACD;GACD,CACH"}