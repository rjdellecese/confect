{"version":3,"file":"Spec.js","names":[],"sources":["../../../src/api/Spec.ts"],"sourcesContent":["import { Predicate, Record } from \"effect\";\nimport type * as GroupSpec from \"./GroupSpec\";\n\nexport const TypeId = \"@rjdellecese/confect/api/Spec\";\nexport type TypeId = typeof TypeId;\n\nexport const isSpec = (u: unknown): u is Spec.Any =>\n  Predicate.hasProperty(u, TypeId);\n\nexport interface Spec<Groups extends GroupSpec.GroupSpec.AnyWithProps = never> {\n  readonly [TypeId]: TypeId;\n  readonly groups: {\n    [GroupName in GroupSpec.GroupSpec.Name<Groups>]: GroupSpec.GroupSpec.WithName<\n      Groups,\n      GroupName\n    >;\n  };\n\n  add<Group extends GroupSpec.GroupSpec.AnyWithProps>(\n    group: Group,\n  ): Spec<Groups | Group>;\n}\n\nexport declare namespace Spec {\n  export interface Any {\n    readonly [TypeId]: TypeId;\n  }\n\n  // TODO: Can we extend the `Spec` interface and remove these custom fields?\n  export interface AnyWithProps extends Any {\n    readonly groups: {\n      readonly [key: string]: GroupSpec.GroupSpec.AnyWithProps;\n    };\n    add<Group extends GroupSpec.GroupSpec.AnyWithProps>(\n      group: Group,\n    ): AnyWithProps;\n  }\n\n  export type Groups<Spec_ extends AnyWithProps> =\n    Spec_[\"groups\"][keyof Spec_[\"groups\"]];\n}\n\nconst Proto = {\n  [TypeId]: TypeId,\n\n  add<Group extends GroupSpec.GroupSpec.AnyWithProps>(\n    this: Spec.AnyWithProps,\n    group: Group,\n  ) {\n    const group_ = group as unknown as GroupSpec.GroupSpec.AnyWithProps;\n\n    return makeProto({\n      groups: Record.set(this.groups, group_.name, group_),\n    });\n  },\n};\n\nconst makeProto = <Groups extends GroupSpec.GroupSpec.AnyWithProps>({\n  groups,\n}: {\n  groups: Record.ReadonlyRecord<string, Groups>;\n}): Spec<Groups> =>\n  Object.assign(Object.create(Proto), {\n    groups,\n  });\n\nexport const make = (): Spec => makeProto({ groups: Record.empty() });\n"],"mappings":";;;;;;;;;AAGA,MAAa,SAAS;AAGtB,MAAa,UAAU,MACrB,UAAU,YAAY,GAAG,OAAO;AAmClC,MAAM,QAAQ;EACX,SAAS;CAEV,IAEE,OACA;EACA,MAAM,SAAS;AAEf,SAAO,UAAU,EACf,QAAQ,OAAO,IAAI,KAAK,QAAQ,OAAO,MAAM,OAAO,EACrD,CAAC;;CAEL;AAED,MAAM,aAA8D,EAClE,aAIA,OAAO,OAAO,OAAO,OAAO,MAAM,EAAE,EAClC,QACD,CAAC;AAEJ,MAAa,aAAmB,UAAU,EAAE,QAAQ,OAAO,OAAO,EAAE,CAAC"}