{"version":3,"file":"ActionRunner.js","names":["Effect","Schema","Context","Layer"],"sources":["../../../src/server/ActionRunner.ts"],"sourcesContent":["import { type GenericActionCtx } from \"convex/server\";\nimport { Context, Effect, Layer, Schema } from \"effect\";\nimport * as Refs from \"../api/Refs\";\n\nconst makeActionRunner =\n  (runAction: GenericActionCtx<any>[\"runAction\"]) =>\n  <Action extends Refs.Ref.AnyAction>(\n    action: Action,\n    args: Refs.Ref.Args<Action>[\"Type\"],\n  ) =>\n    Effect.gen(function* () {\n      const function_ = Refs.getFunction(action);\n      const functionName = Refs.getConvexFunctionName(action);\n\n      const encodedArgs = yield* Schema.encode(function_.args)(args);\n      const encodedReturns = yield* Effect.promise(() =>\n        runAction(functionName as any, encodedArgs),\n      );\n      return yield* Schema.decode(function_.returns)(encodedReturns);\n    });\n\nexport const ActionRunner = Context.GenericTag<\n  ReturnType<typeof makeActionRunner>\n>(\"@rjdellecese/confect/server/ActionRunner\");\nexport type ActionRunner = typeof ActionRunner.Identifier;\n\nexport const layer = (runAction: GenericActionCtx<any>[\"runAction\"]) =>\n  Layer.succeed(ActionRunner, makeActionRunner(runAction));\n"],"mappings":";;;;;;;;;;AAIA,MAAM,oBACH,eAEC,QACA,SAEAA,cAAO,IAAI,aAAa;CACtB,MAAM,yCAA6B,OAAO;CAC1C,MAAM,sDAA0C,OAAO;CAEvD,MAAM,cAAc,OAAOC,cAAO,OAAO,UAAU,KAAK,CAAC,KAAK;CAC9D,MAAM,iBAAiB,OAAOD,cAAO,cACnC,UAAU,cAAqB,YAAY,CAC5C;AACD,QAAO,OAAOC,cAAO,OAAO,UAAU,QAAQ,CAAC,eAAe;EAC9D;AAEN,MAAa,eAAeC,eAAQ,WAElC,2CAA2C;AAG7C,MAAa,SAAS,cACpBC,aAAM,QAAQ,cAAc,iBAAiB,UAAU,CAAC"}