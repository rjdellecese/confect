{"version":3,"file":"VectorSearch.js","names":["Effect","Context","Layer"],"sources":["../../../src/server/VectorSearch.ts"],"sourcesContent":["import type {\n  Expand,\n  GenericActionCtx,\n  NamedTableInfo,\n  VectorIndexNames,\n  VectorSearchQuery,\n} from \"convex/server\";\nimport type { GenericId } from \"convex/values\";\nimport { Context, Effect, Layer } from \"effect\";\nimport type * as DataModel from \"./DataModel\";\n\ntype VectorSearch_<DataModel_ extends DataModel.DataModel.AnyWithProps> =\n  GenericActionCtx<DataModel.DataModel.ToConvex<DataModel_>>[\"vectorSearch\"];\n\nexport const make =\n  <DataModel_ extends DataModel.DataModel.AnyWithProps>(\n    vectorSearch: VectorSearch_<DataModel_>,\n  ) =>\n  <\n    TableName extends DataModel.DataModel.TableNames<DataModel_>,\n    IndexName extends VectorIndexNames<\n      NamedTableInfo<DataModel.DataModel.ToConvex<DataModel_>, TableName>\n    >,\n  >(\n    tableName: TableName,\n    indexName: IndexName,\n    query: Expand<\n      VectorSearchQuery<\n        NamedTableInfo<DataModel.DataModel.ToConvex<DataModel_>, TableName>,\n        IndexName\n      >\n    >,\n  ): Effect.Effect<Array<{ _id: GenericId<TableName>; _score: number }>> =>\n    Effect.promise(() => vectorSearch(tableName, indexName, query));\n\nexport const VectorSearch = <\n  DataModel_ extends DataModel.DataModel.AnyWithProps,\n>() =>\n  Context.GenericTag<ReturnType<typeof make<DataModel_>>>(\n    \"@rjdellecese/confect/server/VectorSearch\",\n  );\n\nexport type VectorSearch<DataModel_ extends DataModel.DataModel.AnyWithProps> =\n  ReturnType<typeof VectorSearch<DataModel_>>[\"Identifier\"];\n\nexport const layer = <DataModel_ extends DataModel.DataModel.AnyWithProps>(\n  vectorSearch: VectorSearch_<DataModel_>,\n) => Layer.succeed(VectorSearch<DataModel_>(), make(vectorSearch));\n"],"mappings":";;;;;;;;;AAcA,MAAa,QAET,kBAQA,WACA,WACA,UAOAA,cAAO,cAAc,aAAa,WAAW,WAAW,MAAM,CAAC;AAEnE,MAAa,qBAGXC,eAAQ,WACN,2CACD;AAKH,MAAa,SACX,iBACGC,aAAM,QAAQ,cAA0B,EAAE,KAAK,aAAa,CAAC"}