{"version":3,"file":"RegistryItem.js","names":["Predicate"],"sources":["../../../src/server/RegistryItem.ts"],"sourcesContent":["import type { Effect } from \"effect\";\nimport { Predicate } from \"effect\";\nimport type * as FunctionSpec from \"../api/FunctionSpec\";\nimport type * as ActionCtx from \"./ActionCtx\";\nimport type * as ActionRunner from \"./ActionRunner\";\nimport type * as Auth from \"./Auth\";\nimport type * as DatabaseReader from \"./DatabaseReader\";\nimport type * as DatabaseWriter from \"./DatabaseWriter\";\nimport type * as DataModel from \"./DataModel\";\nimport type * as MutationCtx from \"./MutationCtx\";\nimport type * as MutationRunner from \"./MutationRunner\";\nimport type * as QueryCtx from \"./QueryCtx\";\nimport type * as QueryRunner from \"./QueryRunner\";\nimport type * as Scheduler from \"./Scheduler\";\nimport type * as DatabaseSchema from \"./DatabaseSchema\";\nimport type {\n  StorageActionWriter,\n  StorageReader,\n  StorageWriter,\n} from \"./Storage\";\nimport type * as VectorSearch from \"./VectorSearch\";\n\n// ============================================================================\n// Type Definitions for Function Implementation Handlers\n// ============================================================================\n\nexport type Handler<\n  Schema extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Function extends FunctionSpec.FunctionSpec.AnyWithProps,\n> =\n  Function extends FunctionSpec.FunctionSpec.WithFunctionType<Function, \"Query\">\n    ? QueryHandler<Schema, Function>\n    : Function extends FunctionSpec.FunctionSpec.WithFunctionType<\n          Function,\n          \"Mutation\"\n        >\n      ? MutationHandler<Schema, Function>\n      : Function extends FunctionSpec.FunctionSpec.WithFunctionType<\n            Function,\n            \"Action\"\n          >\n        ? ActionHandler<Schema, Function>\n        : never;\n\nexport type QueryHandler<\n  Schema extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Function extends\n    FunctionSpec.FunctionSpec.AnyWithPropsWithFunctionType<\"Query\">,\n> = BaseHandler<\n  Function,\n  | DatabaseReader.DatabaseReader<Schema>\n  | Auth.Auth\n  | StorageReader\n  | QueryRunner.QueryRunner\n  | QueryCtx.QueryCtx<\n      DataModel.DataModel.ToConvex<DataModel.DataModel.FromSchema<Schema>>\n    >\n>;\n\nexport type MutationHandler<\n  Schema extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Function extends\n    FunctionSpec.FunctionSpec.AnyWithPropsWithFunctionType<\"Mutation\">,\n> = BaseHandler<\n  Function,\n  | DatabaseReader.DatabaseReader<Schema>\n  | DatabaseWriter.DatabaseWriter<Schema>\n  | Auth.Auth\n  | Scheduler.Scheduler\n  | StorageReader\n  | StorageWriter\n  | QueryRunner.QueryRunner\n  | MutationRunner.MutationRunner\n  | MutationCtx.MutationCtx<\n      DataModel.DataModel.ToConvex<DataModel.DataModel.FromSchema<Schema>>\n    >\n>;\n\nexport type ActionHandler<\n  Schema extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Function extends\n    FunctionSpec.FunctionSpec.AnyWithPropsWithFunctionType<\"Action\">,\n> = BaseHandler<\n  Function,\n  | Scheduler.Scheduler\n  | Auth.Auth\n  | StorageReader\n  | StorageWriter\n  | StorageActionWriter\n  | QueryRunner.QueryRunner\n  | MutationRunner.MutationRunner\n  | ActionRunner.ActionRunner\n  | VectorSearch.VectorSearch<DataModel.DataModel.FromSchema<Schema>>\n  | ActionCtx.ActionCtx<\n      DataModel.DataModel.ToConvex<DataModel.DataModel.FromSchema<Schema>>\n    >\n>;\n\ntype BaseHandler<Function extends FunctionSpec.FunctionSpec.AnyWithProps, R> = (\n  args: FunctionSpec.FunctionSpec.Args<Function>[\"Type\"],\n) => Effect.Effect<\n  FunctionSpec.FunctionSpec.Returns<Function>[\"Type\"],\n  never,\n  R\n>;\n\nexport declare namespace Handler {\n  export type AnyWithProps = Handler<\n    DatabaseSchema.DatabaseSchema.AnyWithProps,\n    FunctionSpec.FunctionSpec.AnyWithProps\n  >;\n\n  export type WithName<\n    Schema extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n    Function extends FunctionSpec.FunctionSpec.AnyWithProps,\n    Name extends string,\n  > = Handler<Schema, FunctionSpec.FunctionSpec.WithName<Function, Name>>;\n}\n\n// ============================================================================\n// RegistryItem - Registry Item\n// ============================================================================\n\nexport const RegistryItemTypeId = \"@rjdellecese/confect/server/RegistryItem\";\nexport type RegistryItemTypeId = typeof RegistryItemTypeId;\n\nexport const isRegistryItem = (\n  value: unknown,\n): value is RegistryItem.AnyWithProps =>\n  Predicate.hasProperty(value, RegistryItemTypeId);\n\nconst RegistryItemProto = {\n  [RegistryItemTypeId]: RegistryItemTypeId,\n};\n\nexport interface RegistryItem<\n  Schema extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Function extends FunctionSpec.FunctionSpec.AnyWithProps,\n> {\n  readonly [RegistryItemTypeId]: RegistryItemTypeId;\n  readonly function_: Function;\n  readonly handler: Handler<Schema, Function>;\n}\n\nexport declare namespace RegistryItem {\n  export interface AnyWithProps {\n    readonly [RegistryItemTypeId]: RegistryItemTypeId;\n    readonly function_: FunctionSpec.FunctionSpec.AnyWithProps;\n    readonly handler: Handler.AnyWithProps;\n  }\n}\n\nexport const make = <\n  Schema extends DatabaseSchema.DatabaseSchema.AnyWithProps,\n  Function extends FunctionSpec.FunctionSpec.AnyWithProps,\n>({\n  function_,\n  handler,\n}: {\n  function_: Function;\n  handler: Handler<Schema, Function>;\n}): RegistryItem<Schema, Function> =>\n  Object.assign(Object.create(RegistryItemProto), {\n    function_,\n    handler,\n  });\n"],"mappings":";;;;;;;;;AA2HA,MAAa,qBAAqB;AAGlC,MAAa,kBACX,UAEAA,iBAAU,YAAY,OAAO,mBAAmB;AAElD,MAAM,oBAAoB,GACvB,qBAAqB,oBACvB;AAmBD,MAAa,QAGX,EACA,WACA,cAKA,OAAO,OAAO,OAAO,OAAO,kBAAkB,EAAE;CAC9C;CACA;CACD,CAAC"}