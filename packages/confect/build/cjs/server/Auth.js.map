{"version":3,"file":"Auth.js","names":["Effect","Option","Layer","Schema"],"sources":["../../../src/server/Auth.ts"],"sourcesContent":["import type { Auth as ConvexAuth } from \"convex/server\";\nimport { Effect, flow, Layer, Option, Schema } from \"effect\";\n\nconst make = (auth: ConvexAuth) => ({\n  getUserIdentity: Effect.promise(() => auth.getUserIdentity()).pipe(\n    Effect.andThen(\n      flow(\n        Option.fromNullable,\n        Option.match({\n          onNone: () => Effect.fail(new NoUserIdentityFoundError()),\n          onSome: Effect.succeed,\n        }),\n      ),\n    ),\n  ),\n});\n\nexport class Auth extends Effect.Tag(\"@rjdellecese/confect/server/Auth\")<\n  Auth,\n  ReturnType<typeof make>\n>() {}\n\nexport const layer = (auth: ConvexAuth) => Layer.succeed(Auth, make(auth));\n\nexport class NoUserIdentityFoundError extends Schema.TaggedError<NoUserIdentityFoundError>(\n  \"NoUserIdentityFoundError\",\n)(\"NoUserIdentityFoundError\", {}) {\n  override get message(): string {\n    return \"No user identity found\";\n  }\n}\n"],"mappings":";;;;;;;;;AAGA,MAAM,QAAQ,UAAsB,EAClC,iBAAiBA,cAAO,cAAc,KAAK,iBAAiB,CAAC,CAAC,KAC5DA,cAAO,yBAEHC,cAAO,cACPA,cAAO,MAAM;CACX,cAAcD,cAAO,KAAK,IAAI,0BAA0B,CAAC;CACzD,QAAQA,cAAO;CAChB,CAAC,CACH,CACF,CACF,EACF;AAED,IAAa,OAAb,cAA0BA,cAAO,IAAI,mCAAmC,EAGrE,CAAC;AAEJ,MAAa,SAAS,SAAqBE,aAAM,QAAQ,MAAM,KAAK,KAAK,CAAC;AAE1E,IAAa,2BAAb,cAA8CC,cAAO,YACnD,2BACD,CAAC,4BAA4B,EAAE,CAAC,CAAC;CAChC,IAAa,UAAkB;AAC7B,SAAO"}