{"version":3,"file":"Scheduler.js","names":[],"sources":["../../../src/server/Scheduler.ts"],"sourcesContent":["import type {\n  OptionalRestArgs,\n  SchedulableFunctionReference,\n  Scheduler as ConvexScheduler,\n} from \"convex/server\";\nimport { Context, DateTime, Duration, Effect, Layer } from \"effect\";\n\nconst make = (scheduler: ConvexScheduler) => ({\n  runAfter: <FuncRef extends SchedulableFunctionReference>(\n    delay: Duration.Duration,\n    functionReference: FuncRef,\n    ...args: OptionalRestArgs<FuncRef>\n  ) => {\n    const delayMs = Duration.toMillis(delay);\n\n    return Effect.promise(() =>\n      scheduler.runAfter(delayMs, functionReference, ...args),\n    );\n  },\n  runAt: <FuncRef extends SchedulableFunctionReference>(\n    dateTime: DateTime.DateTime,\n    functionReference: FuncRef,\n    ...args: OptionalRestArgs<FuncRef>\n  ) => {\n    const timestamp = DateTime.toEpochMillis(dateTime);\n\n    return Effect.promise(() =>\n      scheduler.runAt(timestamp, functionReference, ...args),\n    );\n  },\n});\n\nexport const Scheduler = Context.GenericTag<ReturnType<typeof make>>(\n  \"@rjdellecese/confect/server/Scheduler\",\n);\nexport type Scheduler = typeof Scheduler.Identifier;\n\nexport const layer = (scheduler: ConvexScheduler) =>\n  Layer.succeed(Scheduler, make(scheduler));\n"],"mappings":";;;;;;;;AAOA,MAAM,QAAQ,eAAgC;CAC5C,WACE,OACA,mBACA,GAAG,SACA;EACH,MAAM,UAAU,SAAS,SAAS,MAAM;AAExC,SAAO,OAAO,cACZ,UAAU,SAAS,SAAS,mBAAmB,GAAG,KAAK,CACxD;;CAEH,QACE,UACA,mBACA,GAAG,SACA;EACH,MAAM,YAAY,SAAS,cAAc,SAAS;AAElD,SAAO,OAAO,cACZ,UAAU,MAAM,WAAW,mBAAmB,GAAG,KAAK,CACvD;;CAEJ;AAED,MAAa,YAAY,QAAQ,WAC/B,wCACD;AAGD,MAAa,SAAS,cACpB,MAAM,QAAQ,WAAW,KAAK,UAAU,CAAC"}